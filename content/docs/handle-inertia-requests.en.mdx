---
title: HandleInertiaRequests
description: Customizing global data sharing with Inertia in Swell.
---

## Quick reminder: the Inertia middleware

By default, the `share` method of the `HandleInertiaRequests` middleware allows you to define data accessible on all pages on the frontend. You can inject variables, callbacks, or even closures for lazy loading.

## Customizing the middleware in Swell

In **Swell**, the `share` method has been extensively customized to meet the application's needs.
Here's what is shared:

```php title="app/Http/Middleware/HandleInertiaRequests.php"
public function share(Request $request): array
{
    return [
        ...parent::share($request),
        'name' => config('app.name'),
        'swell' => [
            'wishlist' => [
                'enabled' => config('swell.wishlist.enabled', true),
            ],
            'banner' => [
                'enabled' => config('swell.banner.enabled', true),
            ]
        ],
        'auth' => [
            'user' => fn () => $request->user()?->with('roles')->first(),
        ],
        'ziggy' => fn (): array => [
            ...(new Ziggy)->toArray(),
            'location' => $request->url(),
        ],
        'sidebarOpen' => ! $request->hasCookie('sidebar_state') || $request->cookie('sidebar_state') === 'true',
        'categories' => fn () => Cache::rememberForever('categories', fn () => CategoryResource::collection(Category::with(['childrenRecursive' => fn($q) => $q->withCount('products')])->withCount('products')->whereNull('parent_id')->get())),
        'cart' => fn () => Cache::remember("cart-" . (auth()->check() ? 'user-' . auth()->id() : 'session-' . session()->getId()), 30, function () {
            return CartResource::make(CartFactory::make()->load('items.product.images', 'items.product.brand'));
        }),
        'infoBanner' => fn () => config('swell.banner.enabled', true) ? Cache::rememberForever('infoBanner', fn () => BannerMessage::orderBy('order')->get()) : [],
    ];
}
```

### Details of shared data

| Property      | Description                                                                                                             |
| ------------- | ----------------------------------------------------------------------------------------------------------------------- |
| `name`        | The application name, injected from config.                                                                            |
| `swell`       | An array of activatable features (wishlist, banner), to dynamically control the frontend.                             |
| `auth.user`   | The connected user, with their roles, loaded on demand (closure to avoid unnecessary queries if not used).            |
| `ziggy`       | Frontend routes generated by Ziggy, with current location.                                                             |
| `sidebarOpen` | Sidebar open state, based on a cookie.                                                                                 |
| `categories`  | Main categories, with their children and product count, cached for better performance.                                 |
| `cart`        | User's cart (or session), also cached.                                                                                 |
| `infoBanner`  | Info banner messages, retrieved and cached if the feature is enabled.                                                  |

### Why these choices?

-   **Closures**: Allow loading data only if used on the frontend (lazy loading).
-   **Cache**: Optimizes performance for heavy or rarely changing data (categories, banners, cart).

## Frontend typing: SharedData

To ensure consistency between backend and frontend, it's important to adapt typing on the frontend side (typically the `SharedData` type in your TypeScript code). Each key shared here must be declared and typed on the frontend to benefit from autocompletion and avoid errors.

<Callout>Remember to update the `SharedData` type with each addition/modification in the middleware.</Callout>

## Frontend usage example: retrieving the connected user

Here's how to access the connected user in a React component with Inertia.js:

```ts
import type { SharedData } from "@/types";
import { Link, usePage } from '@inertiajs/react';

export default function Example() {
    const { auth } = usePage<SharedData>().props;

    return (
        <div>
            {auth.user ? (
                <UserDropdown user={auth.user} />
            ) : (
                <Link href="/login">
                    <User size={20} />
                </Link>
            )}
        </div>
    );
}
```

<Callout>
    For more info on the HandleInertiaRequests middleware. See the
    [Inertia](https://inertiajs.com/shared-data) documentation.
</Callout>